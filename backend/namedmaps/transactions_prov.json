{
  "version": "0.0.1",
  "name": "transactions_prov",
  "auth": {
    "method": "open"
  },
  "placeholders": {
    "date_start": {
      "type": "sql_ident",
      "default": "'2015-01-01'"
    },
    "date_finish": {
      "type": "sql_ident",
      "default": "'2015-07-01'"
    },
    "threshold_0" : {
        "type": "number",
        "default" : 1
    },
    "threshold_1" : {
        "type": "number",
        "default" : 1
    },
    "threshold_2" : {
        "type": "number",
        "default" : 2
    },
    "threshold_3" : {
        "type": "number",
        "default" : 3
    },
    "threshold_4" : {
        "type": "number",
        "default" : 4
    },
    "threshold_5" : {
        "type": "number",
        "default" : 5
    },
    "threshold_6" : {
        "type": "number",
        "default" : 6
    },
    "threshold_7" : {
        "type": "number",
        "default" : 7
    },
    "threshold_8" : {
        "type": "number",
        "default" : 8
    },
    "threshold_9" : {
        "type": "number",
        "default" : 9
    },
    "threshold_10" : {
        "type": "number",
        "default" : 10
    },
    "threshold_11" : {
        "type": "number",
        "default" : 11
    },
    "threshold_value_0" : {
        "type": "number",
        "default" : 1
    },
    "threshold_value_1" : {
        "type": "number",
        "default" : 1
    },
    "threshold_value_2" : {
        "type": "number",
        "default" : 2
    },
    "threshold_value_3" : {
        "type": "number",
        "default" : 3
    },
    "threshold_value_4" : {
        "type": "number",
        "default" : 4
    },
    "threshold_value_5" : {
        "type": "number",
        "default" : 5
    },
    "threshold_value_6" : {
        "type": "number",
        "default" : 6
    },
    "threshold_value_7" : {
        "type": "number",
        "default" : 7
    },
    "threshold_value_8" : {
        "type": "number",
        "default" : 8
    },
    "threshold_value_9" : {
        "type": "number",
        "default" : 9
    },
    "threshold_value_10" : {
        "type": "number",
        "default" : 10
    },
    "threshold_value_11" : {
        "type": "number",
        "default" : 11
    },
    "family":{
      "type" : "sql_ident",
      "default" : "%"
    },
    "payment_type":{
      "type" : "sql_ident",
      "default" : "%"
    }
  },
  "layergroup": {
    "version": "1.0.1",
    "layers": [{
        "type": "cartodb",
        "options": {
            "cartocss_version": "2.1.1",
            "cartocss": "#transactions{marker-fill-opacity: 0.9;marker-line-color: #FFF;marker-line-width: 0.5;marker-line-opacity: 1;marker-placement: point;marker-multi-policy: largest;marker-type: ellipse;marker-fill: #F11810;marker-allow-overlap: true;marker-clip: false;}#transactions[n>=<%= threshold_0 %>]{marker-width:<%= threshold_value_0 %>;}#transactions[n>=<%= threshold_1 %>]{marker-width:<%= threshold_value_1 %>;}#transactions[n>=<%= threshold_2 %>]{marker-width:<%= threshold_value_2 %>;}#transactions[n>=<%= threshold_3 %>]{marker-width:<%= threshold_value_3 %>;}#transactions[n>=<%= threshold_4 %>]{marker-width:<%= threshold_value_4 %>;}#transactions[n>=<%= threshold_5 %>]{marker-width:<%= threshold_value_5 %>;}#transactions[n>=<%= threshold_6 %>]{marker-width:<%= threshold_value_6 %>;}#transactions[n>=<%= threshold_7 %>]{marker-width:<%= threshold_value_7 %>;}#transactions[n>=<%= threshold_8 %>]{marker-width:<%= threshold_value_8 %>;}#transactions[n>=<%= threshold_9 %>]{marker-width:<%= threshold_value_9 %>;}#transactions[n>=<%= threshold_10 %>]{marker-width:<%= threshold_value_10 %>;}#transactions[n>=<%= threshold_11 %>]{marker-width:<%= threshold_value_11 %>;}",
            "sql": "SELECT p.cartodb_id,SUM(a.importe_abonado) as n,p.name,p.the_geom,p.the_geom_webmercator FROM transactions a INNER JOIN spain_provinces_centroids p ON p.cod_prov=a.prov WHERE familia_pago LIKE '<%= family %>' AND payment_type LIKE '<%= payment_type %>' AND date_transaction>= <%= date_start %> AND date_transaction<= <%= date_finish %>    GROUP BY a.prov,p.cartodb_id",
            "interactivity": ["cartodb_id", "name","n"]
        }
      }
    ]
  }
}
